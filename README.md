# Stalkee
*Хабар принёс?*

> Бот [Telegram](https://telegram.org), сохраняющий голосовые сообщения, заданные администратором, и отправляющий их по инлайн запросам с сортировкой по числу использований.  
\+ анектоды  
\+ истории  
\+ музыкальная пауза

![](https://img.shields.io/tokei/lines/github/arebaka/stalkee)
![](https://img.shields.io/github/repo-size/arebaka/stalkee)
![](https://img.shields.io/npm/v/stalkee)
![](https://img.shields.io/codefactor/grade/github/arebaka/stalkee)

![](https://img.shields.io/badge/Russian-100%25-brightgreen)

![тут должен быть скриншот инлайн запроса, но куда то делся](https://user-images.githubusercontent.com/36796676/127343858-474b275f-ab45-4a23-9c96-b118f4d389d1.png)

## Команды (deprecated)
`/anecdot` – получить случайный анекдот  
`/story` – получить случайную историю  
`/music` – получить заданное аудио  
`/add` – добавить реплику для инлайна  
`/remove` – удалить реплику  
`/addanecdot` – добавить анекдот  
`/addstory` – добавить историю  
`/setmusic` – поставить музыку  
Инлайн запрос: поиск по репликам

## TLDR (deprecated)
1. Создай и настрой бота через [@BotFather](//t.me/BotFather)
2. Установи [PostgreSQL](//www.postgresql.org/download/), если не стоит
3. Создай в PSQL пустую базу данных 'stalkee' с доступом от своего юзера
4. Установи [npm](//www.npmjs.com) и [node.js](//npmjs.com/package/node)
5. `npm i stalkee`
6. `export TOKEN=<ТОКЕН_ОТ_BOTFATHER>`
7. `export ADMIN_ID=<ТВОЙ_TELEGRAM_ID>` (узнать [тут](//t.me/myidbot))
8. `npx stalkee`
9. Кидай своему боту голосовые и отвечай на них одиночными сообщениями в таком формате:
> `/add <ПЕРСОНАЖ>`  
> `<РЕПЛИКА>`
10. Для удаления добавленной реплики ответь на голосовое с ней командой `/remove`
11. Если хочешь добавить анекдот, скинь его боту, а затем ответь на своё сообщение: `/addanecdot`
12. Если хочешь добавить историю, скинь боту голосовое, а затем ответь на него командой `/addstory`
13. Чтобы задать музыку, скинь боту аудиофайл и ответь на него командой `/setmusic`
14. Для остановки бота напиши в консоли с ним `stop` и нажми enter.

## Подготовка (deprecated)
1. Создай бота через [@BotFather](//t.me/BotFather), все инструкции он выдаёт сам, получи токен
2. Бот использует СУБД PostgreSQL. [Установи](//www.postgresql.org/download/), если у тебя её нет
3. Создай базу данных в PSQL для своего бота
4. Бот работает на [node.js](//npmjs.com/package/node), используя менеджер пакетов [npm](//www.npmjs.com). Установи их
5. Узнай свой Telegram ID с помощью любого специального бота, например, [этого](//t.me/myidbot)

## Установка
```bash
npm i stalkee
```

## Запуск (deprecated)
Для запуска бота нужны переменные окружения. Вот их список:  
`TOKEN` – токен бота от @BotFather  
`ADMIN_ID` – твой Telegram ID  
`DBURI` – URI-строка для подключения к PSQL в формате `postgres://<USER>:<PASSWORD>@<HOST>/<DATABASE>:<PORT>`  
`RESPONSE_LIMIT` – максимальное количество результатов по инлайн запросу, по умолчанию 20, не рекомендуется ставить выше 50

Вместо задания параметров через переменные окружения можно прописать их в файле `config.toml`.

После задания окружения выполни
```bash
npx stalkee
```

Если всё прошло успешно, ты увидишь в консоли что то вроде этого:
```
> stalkee@1.2.0 start
> node index.js

Bot @stalkeeBot started.
> _
```

## Управление (deprecated)
После запуска в консоли доступны команды `stop` и `reload` для безопасных остановки и перезагрузки соответственно.

Управление голосовыми и анекдотами осуществляется через общение с ботом в Telegram. Админу (тому, чей ID прописан в окружении) доступны следующие команды:

**Добавление голосового сообщения в результаты инлайна**
> `/add <ПЕРСОНАЖ>`  
> `<РЕПЛИКА>`

Командой необходимо ответить на голосовое сообщение, которое и будет добавлено.

**Удаление голосового сообщения из результатов**
> `/remove`

Командой так же необходимо ответить на добавленное голосовое.

**Добавление анекдота**
> `/addanecdot`

Командой необходимо отвечать на текстовое сообщение с будущим анекдотом.

**Добавление истории**
> `/addstory`

Командой необходимо отвечать на голосовое сообщение с историей.

**Задание музыки**
> `/setmusic`

Если не баклан, сам догадаешься, на что отвечать.

## Поддержка
Если у тебя чу то не получается, или ты просто хочешь поговорить с создателем бота или его мамой, пиши [@arelive](https://t.me/arelive). Сюда же принимаются пинки от добровольных проект-менеджеров.
